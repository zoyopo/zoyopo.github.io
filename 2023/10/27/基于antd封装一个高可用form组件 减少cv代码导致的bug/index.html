

<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>基于antd封装一个高可用form组件 减少cv代码导致的bug - 小笼包的须弥芥子</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="google" content="notranslate" />
  <meta name="referrer" content="no-referrer" />
  
  <meta name="keywords" content="react,vue,react-native,webpack,javascript,css,nodejs,happy daily,"> 
  
  <meta name="description" content="a blog share frontend coding experience and happy day,引言在开发中台过程中 我们的原型中有很多表单，antd..."> 
  
  <meta name="author" content="zhangyunpeng"> 

  
    <link rel="icon" href="/images/icons/favicon-16x16.png" type="image/png" sizes="16x16">
  
  
    <link rel="icon" href="/images/icons/favicon-32x32.png" type="image/png" sizes="32x32">
  
  
    <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png" sizes="180x180">
  
  
    <meta rel="mask-icon" href="/images/icons/stun-logo.svg" color="#333333">
  
  
    <meta rel="msapplication-TileImage" content="/images/icons/favicon-128x128.png">
    <meta rel="msapplication-TileColor" content="#000000">
  

  
<link rel="stylesheet" href="/css/style.css">


  
  
<link rel="stylesheet" href="//at.alicdn.com/t/font_1445822_58xq2j9v1id.css">

  

  
  
  
<link rel="stylesheet" href="/lib/fancybox/fancybox.css">

  

  
  
  
<link rel="stylesheet" href="/lib/highlight/drucula.min.css">

  

  
  
  
<link rel="stylesheet" href="/lib/justifiedGallery/justifiedGallery.css">

  

  <script>
    var CONFIG = window.CONFIG || {}
    CONFIG = {
      fancybox: true,
      pjax: false,
      lazyload: {
        enable: true,
        loadingImage: '/images/theme/loading.gif',
      },
      donate_alipay: 'https://pic.imgdb.cn/item/622edf135baa1a80abb1276b.jpg',
      donate_wechat: 'https://pic.imgdb.cn/item/622edf115baa1a80abb1253f.jpg',
      motto: {
        api: 'https://v1.hitokoto.cn/?encode=text&amp;c=d',
        default: '不要温和地走进那良夜'
      },
      galleries: {
        enable: 'true'
      },
      fab: {
        enable: 'true',
        alwaysShow: 'false'
      }
    }
  </script>

  

  
<meta name="generator" content="Hexo 4.2.1"></head>

<body class="lock-screen">
  <div class="loading"></div>
  <nav class="menu">
  <div class="menu-close">
    <i class="iconfont iconplus"></i>
  </div>
  <ul class="menu-content">
    
    
    
    
    <li class="menu-item"><a href="/ "> 首页</a></li>
    
    
    
    
    <li class="menu-item"><a href="https://juejin.cn/user/8451824025757 " target="_blank" rel="noopener"> 掘金</a></li>
    
    
    
    
    <li class="menu-item"><a href="/archives "> 归档</a></li>
    
    
    
    
    <li class="menu-item"><a href="/tags "> 标签</a></li>
    
    
    
    
    <li class="menu-item"><a href="/categories "> 分类</a></li>
    
    
    
    
    <li class="menu-item"><a href="/about "> 关于</a></li>
    
  </ul>
  <div class="menu-copyright"><p>Copyright© 2021-2022 | <a target="_blank" href="https://github.com/zoyopo">小笼包</a> .AllRightsReserved</p></div>
</nav>
  <main id="main">
  <div class="container" id="container">
    <article class="article">
  <section class="head">
  <img   class="lazyload" data-original="https://pic.imgdb.cn/item/622b163c5baa1a80abe8a34f.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="  draggable="false">
  <div class="head-mask">
    <h1 class="head-title">基于antd封装一个高可用form组件 减少cv代码导致的bug</h1>
    <div class="head-info">
      <span class="post-info-item"><i class="iconfont iconcalendar"></i>2023-10-27</span
        class="post-info-item">
      
      <span class="post-info-item"><i class="iconfont iconfont-size"></i>46018</span>
    </div>
  </div>
</section>

  <section class="main">
    <section class="content">
      <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>在开发中台过程中 我们的原型中有很多表单，antd有表单组件，但是粒度比较细，就单纯组件而言，无可厚非，但是在开发过程中，可能会造成代码不够聚合，有些表单公共逻辑无法提取，copy paste比较多，所以可以加以封装，搞一个兼容性和扩展性都契合项目本身的组件。</p>
<h2 id="主要思路"><a href="#主要思路" class="headerlink" title="主要思路"></a>主要思路</h2><p>我简单查阅了一番资料，参考了一下别人的封装方式，决定以<code>Col</code>和<code>FormItem</code>作为基本单元，进行表单的搭建，主要原因</p>
<ul>
<li>可以将<code>FormItem</code>的信息和<code>Col</code>的信息以对象方式传入，这样我们可以更加专注于组件的包含的信息 减少CV代码可能导致的bug</li>
<li><code>Col</code>可以进行布局的调整，可以调整表单单元位置和所占宽度</li>
<li>表单的组件形式是不定的，可能是input也有可能是select,所以可以进行外部传入，通用属性可以内部修改</li>
<li>复用性高，可以用它来实现一个纯提交表单 和列表组件结合成可搜索表单  或者其他任何项目里需要自定义的一个表单</li>
</ul>
<h2 id="实现细节"><a href="#实现细节" class="headerlink" title="实现细节"></a>实现细节</h2><h3 id="抽象的FormItemInfo"><a href="#抽象的FormItemInfo" class="headerlink" title="抽象的FormItemInfo"></a>抽象的<code>FormItemInfo</code></h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> FormItemInfo &#123;<br>  name: <span class="hljs-built_in">string</span>, <span class="hljs-comment">//label</span><br>  id: <span class="hljs-built_in">string</span>, <span class="hljs-comment">// 属性</span><br>  colLayOut?: object,<span class="hljs-comment">// 列布局</span><br>  formItemLayout?: object,<span class="hljs-comment">// 表单项布局</span><br>  Comp?: <span class="hljs-built_in">any</span>, <span class="hljs-comment">// 传入的组件 不传默认input</span><br>  ruleArr?: RuleObj[],<span class="hljs-comment">// 验证规则</span><br>  initialValue?: <span class="hljs-built_in">string</span>, <span class="hljs-comment">// 初始值</span><br>  required?: <span class="hljs-built_in">boolean</span>, <span class="hljs-comment">// 是否必填</span><br>  CompExtraProps?: object <span class="hljs-comment">// 传入组件额外属性</span><br>  isDetail?: <span class="hljs-built_in">boolean</span> <span class="hljs-comment">//是否需要被getFieldDecorator托管</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="baseForm组件"><a href="#baseForm组件" class="headerlink" title="baseForm组件"></a>baseForm组件</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs typescript"> * <span class="hljs-meta">@param</span> name 表单项label<br> * <span class="hljs-meta">@param</span> id 属性字段名<br> * <span class="hljs-meta">@param</span> colLayOut 列布局<br> * <span class="hljs-meta">@param</span> formItemLayout 表单项布局<br> * <span class="hljs-meta">@param</span> Comp 传入的组件 不传默认input<br> * <span class="hljs-meta">@param</span> ruleArr 验证规则 长度只需传入｛max:xxx｝验证信息是统一的<br> * <span class="hljs-meta">@param</span> initialValue 初始值 编辑时推荐使用antd的mapPropsToFields 不要手动设置回显值<br> * <span class="hljs-meta">@param</span> required 是否必填 默认否 因为要统一写验证提示<br> * <span class="hljs-meta">@param</span> CompExtraProps 组件额外属性<br>  <span class="hljs-keyword">const</span> mapToFormItem = <span class="hljs-function">(<span class="hljs-params">val: FormItemInfo</span>) =&gt;</span> &#123;<br> ......<br> <span class="hljs-comment">// 是否传入组件</span><br>    <span class="hljs-keyword">const</span> hasCompType = Comp &amp;&amp; Comp.type<br>    <span class="hljs-comment">// 根据组件类型 给出提示文字</span><br>    <span class="hljs-keyword">const</span> msg = getMsgByCompType(hasCompType &amp;&amp; hasCompType.name, name)<br>    <span class="hljs-comment">// 判断是不是select组件 是的话 调整宽度样式</span><br>    <span class="hljs-keyword">const</span> mixStyle = fixStyleByCompType(hasCompType &amp;&amp; hasCompType.name)<br>    <span class="hljs-comment">// 生成验证规则</span><br>    <span class="hljs-keyword">const</span> rules = getFormRules(ruleArr || [], required || <span class="hljs-literal">false</span>, name)<br><br>  <span class="hljs-keyword">return</span> (<br>      &lt;Col &#123;...(colLayOut || defaultColSpan)&#125; key=&#123;id&#125;&gt;<br>        &#123;!isDetail ?<br>          &lt;FormItem label=&#123;name&#125; key=&#123;id&#125; &#123;...(formItemLayout || &#123;&#125;)&#125;&gt;<br>            &#123;<span class="hljs-comment">/*用cloneElement方法给传入的组件加新属性*/</span>&#125;<br>            &#123;<br>              getFieldDecorator(id, &#123;<br>                initialValue: initialValue || <span class="hljs-string">''</span>,<br>                rules,<br>              &#125;)(Comp ? React.cloneElement(Comp, &#123; placeholder: msg, ...mixStyle, ...CompExtraProps &#125;) : &lt;Input <span class="hljs-keyword">type</span>=<span class="hljs-string">"text"</span> placeholder=&#123;msg&#125;/&gt;)<br>            &#125;<br>          &lt;<span class="hljs-regexp">/FormItem&gt; : &lt;FormItem label=&#123;name&#125; key=&#123;id&#125; &#123;...(formItemLayout || &#123;&#125;)&#125;&gt; &#123;Comp&#125;&lt;/</span>FormItem&gt;&#125;<br>      &lt;<span class="hljs-regexp">/Col&gt;</span><br><span class="hljs-regexp">    )</span><br><span class="hljs-regexp">｝</span><br></code></pre></td></tr></table></figure>

<h3 id="统一方法"><a href="#统一方法" class="headerlink" title="统一方法"></a>统一方法</h3><ul>
<li>根据组件类型 给出提示文字</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**根据组件类型 给出提示文字</span><br><span class="hljs-comment"> * @param type 组件类型 根据传入组件的函数名判断 在map里维护</span><br><span class="hljs-comment"> * @param name label名称</span><br><span class="hljs-comment"> * @returns 提示文字</span><br><span class="hljs-comment"> * */</span><br><span class="hljs-keyword">const</span> getMsgByCompType = (name: <span class="hljs-built_in">string</span>, <span class="hljs-keyword">type</span>?: <span class="hljs-built_in">string</span>): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">type</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`请输入<span class="hljs-subst">$&#123;name&#125;</span>`</span><br>  &#125;<br>  <span class="hljs-keyword">const</span> map: &#123; [props: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">string</span> &#125; = &#123;<br>    Select: <span class="hljs-string">'请选择'</span>,<br>    Input: <span class="hljs-string">'请输入'</span>,<br>    <span class="hljs-keyword">default</span>: <span class="hljs-string">'请输入'</span>,<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;map[<span class="hljs-keyword">type</span>] || map.<span class="hljs-keyword">default</span>&#125;</span><span class="hljs-subst">$&#123;name&#125;</span>`</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>生成验证规则</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs plain"> &#x2F;&#x2F; 生成验证规则<br>* @param ruleArr 验证规则 长度只需传入｛max:xxx｝验证信息是统一的<br>* @param name 表单项label<br>* @param required 是否必填 默认否 因为要统一写验证提示<br> const getFormRules &#x3D; (val: RuleObj[], required: boolean, name: string) &#x3D;&gt; &#123;<br>   &#x2F;&#x2F; 根据max生成最长输入提示<br>   const ruleArr: object[] &#x3D; []<br>   val.forEach(item &#x3D;&gt; &#123;<br>     if (&#39;max&#39; in item) &#123;<br>       ruleArr.push(&#123; ...item, message: &#96;输入信息不能超过$&#123;item.max&#125;字&#96; &#125;)<br>     &#125; else &#123;<br>       ruleArr.push(item)<br>     &#125;<br>   &#125;)<br>   &#x2F;&#x2F; 根据name生成报错提示<br>   return [&#123; required: required, message: &#96;$&#123;name&#125;不能为空&#96; &#125;, ...ruleArr]<br></code></pre></td></tr></table></figure>

<ul>
<li>根据组件类型 给出统一样式修改</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**根据组件类型 给出统一样式修改</span><br><span class="hljs-comment"> * @param type 组件类型 根据传入组件的函数名判断 在map里维护</span><br><span class="hljs-comment"> * @returns 样式对象</span><br><span class="hljs-comment"> * */</span><br><span class="hljs-keyword">const</span> fixStyleByCompType = (<span class="hljs-keyword">type</span>?: <span class="hljs-built_in">string</span>): <span class="hljs-function"><span class="hljs-params">object</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">type</span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123;&#125;<br>  &#125;<br>  <span class="hljs-keyword">const</span> map: &#123; [props: <span class="hljs-built_in">string</span>]: object &#125; = &#123;<br>    Select: &#123; style: &#123; width: <span class="hljs-string">'100%'</span> &#125; &#125;,<br>    <span class="hljs-keyword">default</span>: &#123;&#125;,<br>  &#125;<br>  <span class="hljs-keyword">return</span> map[<span class="hljs-keyword">type</span>] || map.default<br>&#125;<br></code></pre></td></tr></table></figure>

<p>注意：<strong>当出现表单显示一个详情文字或者一个按钮 此时需要用<code>isDetail</code>干掉<code>getFieldDecorator托管</code></strong></p>
<h3 id="实现提交表单SubmitForm"><a href="#实现提交表单SubmitForm" class="headerlink" title="实现提交表单SubmitForm"></a>实现提交表单SubmitForm</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs typescript"> * <span class="hljs-meta">@param</span> form -<span class="hljs-string">`antd`</span>的form<br> * <span class="hljs-meta">@param</span> title - 主标题<br> * <span class="hljs-meta">@param</span> subTitle - 分组标题<br> * <span class="hljs-meta">@param</span> FormItemInfos - 二维数组 顺序和数量和分组标题对应 存放表单项信息<br> * <span class="hljs-meta">@param</span> isLoading - <span class="hljs-string">`dva-loading`</span> 执行effects过程中的loading<br> * <span class="hljs-meta">@param</span> onSubmit - 传入的submit方法<br> * <span class="hljs-meta">@param</span> buttonArea - 可选 不传默认数提交和取消 传入覆盖<br> * <span class="hljs-meta">@param</span> children - 在表单下面 按钮区域上面的传入内容<br> * <span class="hljs-meta">@param</span> formLayOutType - 布局方式 详情见<span class="hljs-string">`getLayOutByType`</span>方法<br> * <span class="hljs-meta">@returns</span> ReactNode<br>......<br> &lt;Form onSubmit=&#123;onSubmit&#125;&gt;<br><br>        &lt;SubmitLayOut subTitle=&#123;subTitle&#125; title=&#123;title&#125; renderFormArea=&#123;renderFormArea&#125;&gt;<br>          &#123;children&#125;<br>          &#123;buttonArea?buttonArea: &lt;Row <span class="hljs-keyword">type</span>=<span class="hljs-string">"flex"</span> gutter=&#123;<span class="hljs-number">24</span>&#125; justify=<span class="hljs-string">"center"</span>&gt;<br>            &lt;Col&gt;<br>              &lt;Button <span class="hljs-keyword">type</span>=<span class="hljs-string">"primary"</span> htmlType=<span class="hljs-string">"submit"</span> loading=&#123;isLoading&#125;&gt;提交&lt;<span class="hljs-regexp">/Button&gt;</span><br><span class="hljs-regexp">            &lt;/</span>Col&gt;<br>            &lt;Col&gt;<br>              &lt;Button <span class="hljs-keyword">type</span>=<span class="hljs-string">"default"</span> onClick=&#123;<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> router.go(<span class="hljs-number">-1</span>)&#125;&gt;取消&lt;<span class="hljs-regexp">/Button&gt;</span><br><span class="hljs-regexp">            &lt;/</span>Col&gt;<br>          &lt;<span class="hljs-regexp">/Row&gt;&#125;</span><br><span class="hljs-regexp">        &lt;/</span>SubmitLayOut&gt;<br><br>    &lt;<span class="hljs-regexp">/Form&gt;</span><br></code></pre></td></tr></table></figure>

<p>对<code>BaseForm</code>的调用在<code>renderFormArea</code>方法里</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 水平和垂直布局</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> FormLayOutType &#123;<br>  normal = <span class="hljs-string">'normal'</span>,<br>  vertical = <span class="hljs-string">'vertical'</span><br>&#125;<br><br><span class="hljs-keyword">const</span> renderFormArea = <span class="hljs-function">(<span class="hljs-params">idx: <span class="hljs-built_in">number</span></span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// 在这边加上normal表单的layout</span><br>    <span class="hljs-keyword">const</span> FormItemInfo = FormItemInfos[idx]<br>  <span class="hljs-comment">// 根据传入参数 返回布局类型</span><br>    <span class="hljs-keyword">const</span> _FormItemInfo = getLayOutByType(formLayOutType||FormLayOutType.normal, FormItemInfo)<br>    <span class="hljs-keyword">return</span> &lt;BaseForm formItems=&#123;_FormItemInfo&#125; form=&#123;form&#125;/&gt;<br>  &#125;<br></code></pre></td></tr></table></figure>

<p><code>FormItemInfos</code>这里是二维数组，二维分别承载分组信息和表单项信息 而且在这里用<code>getLayOutByType</code>封装常用的水平 垂直布局方式</p>
<p>这里结合了我们业务里的表单布局 大标题 和小标题对表单区域进行分组，我将布局单独搞了个<code>SubmitLayOut</code>组件 将渲染逻辑和样式组件在其中实现 这样也方便更换成其他<code>LayOut</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// SubmitLayOut</span><br> * <span class="hljs-meta">@param</span> title - 主标题<br> * <span class="hljs-meta">@param</span> subTitle - 分组标题<br> * <span class="hljs-meta">@param</span> renderFormArea - 根据分组的顺序 渲染表单区域<br> * <span class="hljs-meta">@param</span> children - 传入内容<br>......<br>  &lt;Card title=&#123;title&#125; bordered=&#123;<span class="hljs-literal">false</span>&#125; className=&#123;styles[<span class="hljs-string">"special-card"</span>]&#125;&gt;<br>      &lt;List itemLayout=<span class="hljs-string">"vertical"</span> className=<span class="hljs-string">"special-list"</span>&gt;<br>        &#123;subTitle.map(<span class="hljs-function">(<span class="hljs-params">item,idx</span>) =&gt;</span> &#123;<br>          <span class="hljs-keyword">return</span> (<br>            &lt;&gt;<br>              &lt;Meta title=&#123;item&#125;/&gt;<br>              &lt;List.Item&gt;<br>                &#123;renderFormArea(idx)&#125;<br>              &lt;<span class="hljs-regexp">/List.Item&gt;</span><br><span class="hljs-regexp">            &lt;/</span>&gt;<br>          )<br>        &#125;)&#125;<br>      &lt;<span class="hljs-regexp">/List&gt;</span><br><span class="hljs-regexp">      &#123;children&#125;</span><br><span class="hljs-regexp">    &lt;/</span>Card&gt;<br></code></pre></td></tr></table></figure>


<h3 id="SubmitForm-完整代码"><a href="#SubmitForm-完整代码" class="headerlink" title="SubmitForm 完整代码"></a>SubmitForm 完整代码</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 提交表单</span><br><span class="hljs-comment"> * @param form -`antd`的form</span><br><span class="hljs-comment"> * @param title - 主标题</span><br><span class="hljs-comment"> * @param subTitle - 分组标题</span><br><span class="hljs-comment"> * @param FormItemInfos - 二维数组 顺序和数量和分组标题对应 存放表单项信息</span><br><span class="hljs-comment"> * @param isLoading - `dva-loading` 执行effects过程中的loading</span><br><span class="hljs-comment"> * @param onSubmit - 传入的submit方法</span><br><span class="hljs-comment"> * @param buttonArea - 可选 不传默认数提交和取消 传入覆盖</span><br><span class="hljs-comment"> * @param children - 在表单下面 按钮区域上面的传入内容</span><br><span class="hljs-comment"> * @param formLayOutType - 布局方式 详情见`getLayOutByType`方法</span><br><span class="hljs-comment"> * @param model - 编辑回显传入的值</span><br><span class="hljs-comment"> * @returns ReactNode</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> React, &#123; ReactNode, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;<br><span class="hljs-keyword">import</span> BaseForm, &#123; FormItemInfo &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../BaseForm/BaseFormArea'</span>;<br><span class="hljs-keyword">import</span> &#123; Button, Col, Form, message, Row &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;<br><span class="hljs-keyword">import</span> &#123; If &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'jsx-control-statements'</span>;<br><span class="hljs-keyword">import</span> SubmitLayOut <span class="hljs-keyword">from</span> <span class="hljs-string">'./SubmitLayOut'</span>;<br><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'umi/router'</span>;<br><span class="hljs-keyword">import</span> &#123; unShowSearchToken &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../../../constants/index'</span>;<br><span class="hljs-keyword">import</span> moment <span class="hljs-keyword">from</span> <span class="hljs-string">'moment'</span>;<br><span class="hljs-keyword">import</span> &#123; isDeepEmptyObj &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/common'</span>;<br><span class="hljs-keyword">import</span> addOperLog <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/operLog'</span>;<br><span class="hljs-keyword">import</span> &#123; flatten &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'lodash'</span>;<br><span class="hljs-keyword">import</span> &#123; useDispatch &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react-redux'</span>;<br><span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">'@/pages/policy/index.less'</span>;<br><br><span class="hljs-keyword">interface</span> IProps &#123;<br>  form: <span class="hljs-built_in">any</span>;<br>  title?: <span class="hljs-built_in">string</span> | ReactNode; <span class="hljs-comment">// 新增页 主标题</span><br>  subTitle?: <span class="hljs-built_in">string</span>[]; <span class="hljs-comment">// 新增页 分组标题</span><br>  FormItemInfos: FormItemInfo[][]; <span class="hljs-comment">// 二维数组 应对项目里面表单内容分组</span><br>  isLoading?: <span class="hljs-built_in">boolean</span>; <span class="hljs-comment">// dva的loading</span><br>  onSubmit: <span class="hljs-built_in">Function</span>;<br>  buttonArea?: ReactNode; <span class="hljs-comment">// 重写按钮区域</span><br>  children?: ReactNode;<br>  formLayOutType?: <span class="hljs-built_in">string</span>;<br>  model?: &#123; [props: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">string</span> &#125;;<br>  onCancel?: <span class="hljs-built_in">Function</span>;<br>&#125;<br><br><span class="hljs-comment">// 水平和垂直布局</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> FormLayOutType &#123;<br>  normal = <span class="hljs-string">'normal'</span>,<br>  vertical = <span class="hljs-string">'vertical'</span>,<br>&#125;<br><span class="hljs-keyword">enum</span> CompType &#123;<br>  Select = <span class="hljs-string">'Select'</span>,<br>  PickerWrapper = <span class="hljs-string">'PickerWrapper'</span>,<br>  Cascader = <span class="hljs-string">'Cascader'</span>,<br>  Money = <span class="hljs-string">'Money'</span>,<br>&#125;<br><br><span class="hljs-keyword">enum</span> initVal &#123;<br>  Zero = <span class="hljs-string">'0'</span>,<br>&#125;<br><span class="hljs-keyword">const</span> detailStyle = &#123;<br>  width: <span class="hljs-string">'250px'</span>,<br>  overflow: <span class="hljs-string">'hidden'</span>,<br>  textOverflow: <span class="hljs-string">'ellipsis'</span>,<br>  display: <span class="hljs-string">'block'</span>,<br>  whiteSpace: <span class="hljs-string">'nowrap'</span>,<br>&#125;;<br><span class="hljs-keyword">const</span> SubmitForm = <span class="hljs-function">(<span class="hljs-params">props: IProps</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> dispatch = useDispatch();<br>  <span class="hljs-comment">// const [submitButtonisDisabled,setSubmitButtonisDisabled]=useState(false)</span><br>  <span class="hljs-keyword">const</span> &#123;<br>    title,<br>    subTitle,<br>    FormItemInfos,<br>    form,<br>    isLoading,<br>    buttonArea,<br>    children,<br>    formLayOutType,<br>    model,<br>    onCancel,<br>  &#125; = props;<br><br>  <span class="hljs-comment">// 根据分组的顺序 渲染表单区域</span><br>  <span class="hljs-keyword">const</span> renderFormArea = <span class="hljs-function">(<span class="hljs-params">idx: <span class="hljs-built_in">number</span></span>) =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'FormItemInfos===&gt;'</span>, FormItemInfos);<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'subTitle====&gt;'</span>, subTitle);<br>    <span class="hljs-keyword">const</span> FormItemInfo = FormItemInfos[idx];<br>    <span class="hljs-comment">// 在这边加上normal表单的layout</span><br>    <span class="hljs-keyword">const</span> _FormItemInfo = setFeatureToFormItemInfo(FormItemInfo);<br>    <span class="hljs-keyword">return</span> &lt;BaseForm formItems=&#123;_FormItemInfo&#125; form=&#123;form&#125; /&gt;;<br>  &#125;;<br><br>  <span class="hljs-comment">// 鼠标移入 如果文本溢出 。。。 显示完整的</span><br>  <span class="hljs-keyword">const</span> onDetailMouseEnter = <span class="hljs-function">(<span class="hljs-params">e: <span class="hljs-built_in">any</span></span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> target = e.target;<br>    <span class="hljs-keyword">const</span> containerLength = target.offsetWidth;<br>    <span class="hljs-keyword">const</span> textLength = target.scrollWidth;<br>    <span class="hljs-keyword">const</span> text = target.innerHTML;<br>    <span class="hljs-keyword">if</span> (textLength &gt; containerLength) &#123;<br>      target.setAttribute(<span class="hljs-string">'title'</span>, text);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      target.removeAttribute(<span class="hljs-string">'title'</span>);<br>    &#125;<br>  &#125;;<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 根据传入参数 返回布局类型</span><br><span class="hljs-comment">   * @param type - 表单布局类型 可能为从左到右 也可能为自上而下 默认前者</span><br><span class="hljs-comment">   * @param FormItemInfo - 表单项信息</span><br><span class="hljs-comment">   * @returns FormItemInfo</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">const</span> getLayOutByType = (<span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span>, FormItemInfo: FormItemInfo[]): FormItemInfo[] =&gt; &#123;<br>    <span class="hljs-keyword">const</span> map: &#123; [props: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">Function</span> &#125; = &#123;<br>      <span class="hljs-comment">// 从左至右的布局</span><br>      [FormLayOutType.normal]: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">return</span> FormItemInfo.filter(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> [<span class="hljs-literal">undefined</span>, <span class="hljs-literal">true</span>].includes(item.visible)).map(<br>          (item, idx: <span class="hljs-built_in">number</span>) =&gt; &#123;<br>            <span class="hljs-keyword">if</span> (idx % <span class="hljs-number">3</span> === <span class="hljs-number">0</span>) &#123;<br>              <span class="hljs-keyword">return</span> &#123;<br>                colLayOut: &#123; span: <span class="hljs-number">6</span> &#125;,<br>                ...item,<br>              &#125;;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>              <span class="hljs-keyword">return</span> &#123;<br>                colLayOut: &#123; span: <span class="hljs-number">6</span>, offset: <span class="hljs-number">2</span> &#125;,<br>                ...item,<br>              &#125;;<br>            &#125;<br>          &#125;,<br>        );<br>      &#125;,<br>      <span class="hljs-comment">// 自上而下的布局</span><br>      [FormLayOutType.vertical]: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">return</span> FormItemInfo.map(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> (&#123;<br>          colLayOut: &#123; span: <span class="hljs-number">16</span>, offset: <span class="hljs-number">4</span> &#125;,<br>          formItemLayout: &#123;<br>            labelCol: &#123; span: <span class="hljs-number">6</span> &#125;,<br>            wrapperCol: onCancel ? &#123; span: <span class="hljs-number">18</span> &#125; : &#123; span: <span class="hljs-number">8</span> &#125;,<br>            ...item.formItemLayout,<br>          &#125;,<br>          ...item,<br>        &#125;));<br>      &#125;,<br>    &#125;;<br>    <span class="hljs-keyword">return</span> map[<span class="hljs-keyword">type</span>]();<br>  &#125;;<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 根据组件类型加上额外属性</span><br><span class="hljs-comment">   *    *</span><br><span class="hljs-comment">   * @param FormItemInfo - 表单项信息</span><br><span class="hljs-comment">   * @returns FormItemInfo</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">const</span> setExtrProps = (FormItemInfos: FormItemInfo[]): FormItemInfo[] =&gt; &#123;<br>    <span class="hljs-keyword">return</span> FormItemInfos.map(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>      <span class="hljs-comment">// 是否传入组件</span><br>      <span class="hljs-comment">// const hasCompType = item.Comp &amp;&amp; item.Comp.type</span><br>      <span class="hljs-comment">// console.log('CompType',hasCompType,hasCompType&amp;&amp;hasCompType.name )</span><br>      <span class="hljs-keyword">const</span> <span class="hljs-keyword">type</span> = item.type;<br>      <span class="hljs-comment">// 允许清除</span><br>      <span class="hljs-keyword">const</span> commonFeature = &#123; allowClear: !item.required &#125;;<br>      <span class="hljs-comment">// 如果是‘Select’组件且name不在配置之中</span><br>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> &amp;&amp; <span class="hljs-keyword">type</span> === CompType.Select) &#123;<br>        <span class="hljs-keyword">if</span> (!unShowSearchToken.includes(item.id)) &#123;<br>          <span class="hljs-keyword">return</span> &#123;<br>            CompExtraProps: &#123; ...commonFeature, showSearch: <span class="hljs-literal">true</span>, optionFilterProp: <span class="hljs-string">'children'</span> &#125;,<br>            ...item,<br>          &#125;;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-keyword">return</span> &#123; CompExtraProps: &#123; ...commonFeature &#125;, ...item &#125;;<br>        &#125;<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> &amp;&amp; <span class="hljs-keyword">type</span> === CompType.Cascader &amp;&amp; item.id === <span class="hljs-string">'provincesRegions'</span>) &#123;<br>        <span class="hljs-keyword">return</span> &#123;<br>          CompExtraProps: &#123;<br>            ...commonFeature,<br>            fieldNames: &#123; label: <span class="hljs-string">'parValue'</span>, value: <span class="hljs-string">'parKey'</span>, children: <span class="hljs-string">'childParameter'</span> &#125;,<br>          &#125;,<br>          ...item,<br>        &#125;;<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> &amp;&amp; <span class="hljs-keyword">type</span> === CompType.Money) &#123;<br>        <span class="hljs-keyword">return</span> &#123;<br>          CompExtraProps: &#123;<br>            min: <span class="hljs-number">0</span>,<br>            max: <span class="hljs-number">9999999999.99</span>,<br>            precision: <span class="hljs-number">2</span>,<br>          &#125;,<br>          ruleArr: [<br>            &#123; <span class="hljs-keyword">type</span>: <span class="hljs-string">'number'</span>, max: <span class="hljs-number">9999999999.99</span> &#125;,<br>            &#123; <span class="hljs-keyword">type</span>: <span class="hljs-string">'number'</span>, min: <span class="hljs-number">0</span> &#125;,<br>          ],<br>          ...item,<br>        &#125;;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> item;<br>      &#125;<br>    &#125;);<br>  &#125;;<br>  <span class="hljs-comment">// 编辑的时候加上回显值</span><br>  <span class="hljs-keyword">const</span> setInitValueWhenEdit = (FormItemInfos: FormItemInfo[]): FormItemInfo[] =&gt; &#123;<br>    <span class="hljs-comment">// console.log(isDeepEmptyObj(model))</span><br>    <span class="hljs-keyword">if</span> (model &amp;&amp; !isDeepEmptyObj(model)) &#123;<br>      <span class="hljs-keyword">return</span> FormItemInfos.map(<span class="hljs-function">(<span class="hljs-params">item, idx: <span class="hljs-built_in">number</span></span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">const</span> hasCompType = item.type;<br>        <span class="hljs-comment">// 下拉框 后端给的枚举值是字符串 回显是number 在这里统一</span><br>        <span class="hljs-keyword">let</span> detailValue: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> | moment.Moment | object[] = <span class="hljs-string">''</span>;<br>        <span class="hljs-comment">// 如果是多层级的数据 在这里转换</span><br>        <span class="hljs-keyword">if</span> (item.id.includes(<span class="hljs-string">'.'</span>)) &#123;<br>          <span class="hljs-keyword">const</span> wrapperArr = item.id.split(<span class="hljs-string">'.'</span>);<br>          <span class="hljs-comment">// @ts-ignore</span><br>          detailValue = wrapperArr.reduce(<br>            (previous, current) =&gt; previous &amp;&amp; previous[current],<br>            model,<br>          );<br>          <span class="hljs-comment">// 回显自动加给uploads组件加规定格式的值</span><br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.id === <span class="hljs-string">'fileIdEn'</span>) &#123;<br>          detailValue = model[<span class="hljs-string">'fileIdEn'</span>]<br>            ? [<br>                &#123;<br>                  fileIdEn: model[<span class="hljs-string">'fileIdEn'</span>],<br>                  fileName: model[<span class="hljs-string">'fileName'</span>],<br>                  fileUrl: model[<span class="hljs-string">'fileUrl'</span>]<br>                    ? <span class="hljs-string">`/api<span class="hljs-subst">$&#123;model[<span class="hljs-string">'fileUrl'</span>]&#125;</span>`</span><br>                    : <span class="hljs-string">`/api/file/downloadFile?fileIdEn=<span class="hljs-subst">$&#123;model[<span class="hljs-string">'fileIdEn'</span>]&#125;</span>`</span>,<br>                &#125;,<br>              ]<br>            : [];<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          detailValue = model[item.id];<br>        &#125;<br>        <span class="hljs-keyword">if</span> (hasCompType &amp;&amp; hasCompType === CompType.Select) &#123;<br>          <span class="hljs-comment">// 判断是不是null null不转 /判断是不是0 是0转换</span><br>          <span class="hljs-keyword">return</span> &#123;<br>            ...item,<br>            initialValue:<br>              detailValue || <span class="hljs-string">`<span class="hljs-subst">$&#123;detailValue&#125;</span>`</span> === initVal.Zero ? <span class="hljs-string">`<span class="hljs-subst">$&#123;detailValue&#125;</span>`</span> : <span class="hljs-literal">undefined</span>,<br>          &#125;;<br>          <span class="hljs-comment">// 如果是日期组件 回显值就用moment处理</span><br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (hasCompType &amp;&amp; hasCompType === CompType.PickerWrapper) &#123;<br>          <span class="hljs-keyword">return</span> &#123; ...item, initialValue: detailValue ? moment(detailValue) : <span class="hljs-literal">undefined</span> &#125;;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<br>          hasCompType &amp;&amp;<br>          hasCompType === CompType.Cascader &amp;&amp;<br>          item.id === <span class="hljs-string">'provincesRegions'</span><br>        ) &#123;<br>          <span class="hljs-keyword">return</span> &#123;<br>            ...item,<br>            initialValue: model[<span class="hljs-string">'province'</span>]<br>              ? [model[<span class="hljs-string">'province'</span>], model[<span class="hljs-string">'city'</span>], model[<span class="hljs-string">'county'</span>]]<br>              : <span class="hljs-literal">undefined</span>,<br>          &#125;;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.isDetail) &#123;<br>          <span class="hljs-comment">// // 表单中存在 显示内容</span><br>          <span class="hljs-comment">// if (detailValue||(detailValue===0)) &#123;</span><br><br>          <span class="hljs-comment">//   return &#123; Comp: item.id.includes('fileIdEn') ? &lt;a target="_blank" href=&#123;`/api/file/downloadFile?fileIdEn=$&#123;model['fileIdEn']&#125;`&#125;&gt;&#123;model['fileName']&#125;&lt;/a&gt; : &lt;span style=&#123;&#123; whiteSpace: 'nowrap' &#125;&#125;&gt;&#123;detailValue&#125;&lt;/span&gt;, isDetail: true, ...item &#125;</span><br>          <span class="hljs-comment">// &#125; else &#123;</span><br><br>          <span class="hljs-keyword">return</span> &#123;<br>            ...item,<br>            CompExtraProps: &#123; style: detailStyle &#125;,<br>            Comp: item.initialValue ? (<br>              &lt;span onMouseEnter=&#123;onDetailMouseEnter&#125;&gt;&#123;item.initialValue&#125;&lt;<span class="hljs-regexp">/span&gt;</span><br><span class="hljs-regexp">            ) : (</span><br><span class="hljs-regexp">              &lt;span</span><br><span class="hljs-regexp">                onMouseEnter=&#123;onDetailMouseEnter&#125;</span><br><span class="hljs-regexp">                dangerouslySetInnerHTML=&#123;&#123; __html: '&amp;nbsp;' &#125;&#125;</span><br><span class="hljs-regexp">              &gt;&lt;/</span>span&gt;<br>            ),<br>          &#125;;<br>          <span class="hljs-comment">// &#125;</span><br>        &#125;<br>        <span class="hljs-comment">// 判断是0的情况 显示0</span><br>        <span class="hljs-keyword">else</span><br>          <span class="hljs-keyword">return</span> &#123;<br>            ...item,<br>            initialValue:<br>              item.initialValue ||<br>              (<span class="hljs-string">`<span class="hljs-subst">$&#123;detailValue&#125;</span>`</span> === initVal.Zero ? <span class="hljs-string">`<span class="hljs-subst">$&#123;detailValue&#125;</span>`</span> : detailValue),<br>          &#125;;<br>      &#125;);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// 新增 填入需要显示的值</span><br>      <span class="hljs-keyword">return</span> FormItemInfos.map(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (item.isDetail) &#123;<br>          <span class="hljs-keyword">return</span> &#123;<br>            ...item,<br>            CompExtraProps: &#123; style: detailStyle &#125;,<br>            Comp:<br>              item.initialValue || <span class="hljs-string">`<span class="hljs-subst">$&#123;item.initialValue&#125;</span>`</span> === initVal.Zero ? (<br>                &lt;span onMouseEnter=&#123;onDetailMouseEnter&#125;&gt;&#123;item.initialValue&#125;&lt;<span class="hljs-regexp">/span&gt;</span><br><span class="hljs-regexp">              ) : (</span><br><span class="hljs-regexp">                &lt;span</span><br><span class="hljs-regexp">                  onMouseEnter=&#123;onDetailMouseEnter&#125;</span><br><span class="hljs-regexp">                  dangerouslySetInnerHTML=&#123;&#123; __html: '&amp;nbsp;' &#125;&#125;</span><br><span class="hljs-regexp">                &gt;&lt;/</span>span&gt;<br>              ),<br>          &#125;;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-keyword">return</span> item;<br>        &#125;<br>      &#125;);<br>    &#125;<br>  &#125;;<br><br>  <span class="hljs-keyword">const</span> setStyleToFormItem = (FormItemInfos: FormItemInfo[]): FormItemInfo[] =&gt; &#123;<br>    <span class="hljs-keyword">return</span> FormItemInfos.map(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (item.id?.includes(<span class="hljs-string">'fileIdEn'</span>)) &#123;<br>        <span class="hljs-keyword">return</span> &#123; ...item, className: styles.policyUpload &#125;;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> item;<br>      &#125;<br>    &#125;);<br>  &#125;;<br>  <span class="hljs-keyword">const</span> setFeatureToFormItemInfo = (FormItemInfos: FormItemInfo[]): FormItemInfo[] =&gt; &#123;<br>    <span class="hljs-keyword">let</span> result: FormItemInfo[];<br>    result = getLayOutByType(formLayOutType || FormLayOutType.normal, FormItemInfos);<br><br>    result = setExtrProps(result);<br><br>    result = setInitValueWhenEdit(result);<br><br>    result = setStyleToFormItem(result);<br><br>    <span class="hljs-keyword">return</span> result;<br>  &#125;;<br>  <span class="hljs-comment">// 预处理提交的值</span><br>  <span class="hljs-keyword">const</span> onSubmitedValuesPreHandle = <span class="hljs-function">(<span class="hljs-params">values: &#123; [props: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">string</span> &#125;</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> result: &#123; [props: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">string</span> &#125; = &#123;&#125;;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> values) &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> values[key] === <span class="hljs-string">'string'</span>) &#123;<br>        result[key] = values[key].trim();<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        result[key] = values[key];<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> result;<br>  &#125;;<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * @summary 调用传入的`onSubmit`函数</span><br><span class="hljs-comment">   * @returns void</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">const</span> onSubmit = (e: <span class="hljs-built_in">any</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> &#123;<br>    e.preventDefault();<br>    <span class="hljs-keyword">const</span> &#123;<br>      form: &#123; validateFieldsAndScroll &#125;,<br>      onSubmit,<br>    &#125; = props;<br><br>    validateFieldsAndScroll(<span class="hljs-function">(<span class="hljs-params">err: <span class="hljs-built_in">boolean</span>, values: &#123; [props: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">string</span> &#125;</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (!err) &#123;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'submiting values:'</span>, values);<br>        <span class="hljs-keyword">let</span> submitValues = &#123; ...values &#125;;<br>        <span class="hljs-comment">// 前置处理DatePicker值</span><br>        <span class="hljs-keyword">const</span> formFilterArr = flatten(FormItemInfos).filter(<br>          item =&gt; item.type === CompType.PickerWrapper,<br>        );<br>        formFilterArr.forEach(<br>          item =&gt; (submitValues[item.id] = moment(values[item.id]).format(<span class="hljs-string">'YYYY-MM-DD'</span>)),<br>        );<br>        <span class="hljs-comment">// 前置处理Uploads的值</span><br>        <span class="hljs-keyword">if</span> (values.hasOwnProperty(<span class="hljs-string">'fileIdEn'</span>)) &#123;<br>          submitValues = &#123;<br>            ...submitValues,<br>            fileIdEn: values.fileIdEn[<span class="hljs-number">0</span>] &amp;&amp; values.fileIdEn[<span class="hljs-number">0</span>].fileIdEn,<br>            fileName:<br>              values.fileIdEn[<span class="hljs-number">0</span>] &amp;&amp; (values.fileIdEn[<span class="hljs-number">0</span>].fileName || values.fileIdEn[<span class="hljs-number">0</span>].name),<br>          &#125;;<br>        &#125;<br>        <span class="hljs-keyword">const</span> cb = <span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span>, data: <span class="hljs-built_in">boolean</span> | <span class="hljs-built_in">string</span></span>) =&gt;</span> &#123;<br>          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'rst'</span>, data);<br>          <span class="hljs-keyword">let</span> character: <span class="hljs-built_in">string</span>;<br>          <span class="hljs-keyword">if</span> (path.includes(<span class="hljs-string">'?'</span>)) &#123;<br>            character = <span class="hljs-string">'&amp;'</span>;<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>            character = <span class="hljs-string">'?'</span>;<br>          &#125;<br>          <span class="hljs-keyword">if</span> (data) &#123;<br>            message.success(<span class="hljs-string">'提交成功'</span>);<br><br>            setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>              dispatch(&#123;<br>                <span class="hljs-keyword">type</span>: <span class="hljs-string">'app/updateState'</span>,<br>                payload: &#123; isAuthorized: <span class="hljs-literal">true</span> &#125;,<br>              &#125;);<br>              router.push(path + <span class="hljs-string">`<span class="hljs-subst">$&#123;character&#125;</span>detailIdEn=<span class="hljs-subst">$&#123;data&#125;</span>`</span>);<br>            &#125;);<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>            dispatch(&#123;<br>              <span class="hljs-keyword">type</span>: <span class="hljs-string">'app/updateState'</span>,<br>              payload: &#123; isAuthorized: <span class="hljs-literal">true</span> &#125;,<br>            &#125;);<br>          &#125;<br>        &#125;;<br>        <span class="hljs-comment">// 新增编辑操作加上对应操作日志</span><br>        <span class="hljs-comment">// operType add/update</span><br>        <span class="hljs-comment">// moduleName 模块汉字</span><br>        <span class="hljs-comment">// overrideValues 外部传入的当前values 防止有不在表单里的外部参数</span><br>        <span class="hljs-keyword">const</span> onOperLogSaveCallback = (<br>          operType: <span class="hljs-built_in">string</span>,<br>          moduleName: <span class="hljs-built_in">string</span>,<br>          operParams: &#123; targetType: <span class="hljs-built_in">string</span>; targetIdEn: <span class="hljs-built_in">string</span> &#125;,<br>          overrideValues: &#123;&#125;,<br>        ) =&gt; &#123;<br>          <span class="hljs-comment">// 编辑</span><br>          <span class="hljs-keyword">if</span> (model &amp;&amp; !isDeepEmptyObj(model)) &#123;<br>            addOperLog(<br>              operType,<br>              moduleName,<br>              operParams,<br>              model,<br>              overrideValues || values,<br>              FormItemInfos,<br>            );<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>            addOperLog(operType, moduleName, operParams);<br>          &#125;<br>        &#125;;<br>        <span class="hljs-keyword">const</span> handledValues = onSubmitedValuesPreHandle(submitValues);<br>        <span class="hljs-comment">// 搞出loading</span><br>        dispatch(&#123;<br>          <span class="hljs-keyword">type</span>: <span class="hljs-string">'app/updateState'</span>,<br>          payload: &#123; isAuthorized: <span class="hljs-literal">false</span> &#125;,<br>        &#125;);<br>        onSubmit(handledValues, cb, onOperLogSaveCallback);<br>      &#125;<br>    &#125;);<br>  &#125;;<br><br>  <span class="hljs-keyword">const</span> onBtnCancel = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (onCancel) &#123;<br>      onCancel();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      router.go(<span class="hljs-number">-1</span>);<br>    &#125;<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> (<br>    &lt;Form onSubmit=&#123;onSubmit&#125; labelAlign=<span class="hljs-string">"right"</span>&gt;<br>      &lt;SubmitLayOut subTitle=&#123;subTitle&#125; title=&#123;title&#125; renderFormArea=&#123;renderFormArea&#125;&gt;<br>        &#123;children&#125;<br>        &#123;buttonArea ? (<br>          buttonArea<br>        ) : (<br>          &lt;Row <span class="hljs-keyword">type</span>=<span class="hljs-string">"flex"</span> gutter=&#123;<span class="hljs-number">24</span>&#125; justify=<span class="hljs-string">"center"</span>&gt;<br>            &lt;Col&gt;<br>              &lt;Button <span class="hljs-keyword">type</span>=<span class="hljs-string">"primary"</span> htmlType=<span class="hljs-string">"submit"</span> loading=&#123;isLoading&#125;&gt;<br>                提交<br>              &lt;<span class="hljs-regexp">/Button&gt;</span><br><span class="hljs-regexp">            &lt;/</span>Col&gt;<br>            &lt;If condition=&#123;(model &amp;&amp; !isDeepEmptyObj(model)) || onCancel&#125;&gt;<br>              &lt;Col&gt;<br>                &lt;Button loading=&#123;isLoading&#125; <span class="hljs-keyword">type</span>=<span class="hljs-string">"default"</span> onClick=&#123;onBtnCancel&#125;&gt;<br>                  取消<br>                &lt;<span class="hljs-regexp">/Button&gt;</span><br><span class="hljs-regexp">              &lt;/</span>Col&gt;<br>            &lt;<span class="hljs-regexp">/If&gt;</span><br><span class="hljs-regexp">          &lt;/</span>Row&gt;<br>        )&#125;<br>      &lt;<span class="hljs-regexp">/SubmitLayOut&gt;</span><br><span class="hljs-regexp">    &lt;/</span>Form&gt;<br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> SubmitForm;<br></code></pre></td></tr></table></figure>

<h2 id="FormDetail–表单详情页"><a href="#FormDetail–表单详情页" class="headerlink" title="FormDetail–表单详情页"></a>FormDetail–表单详情页</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 表单详情</span><br><span class="hljs-comment"> * @param form -`antd`的form</span><br><span class="hljs-comment"> * @param title - 主标题</span><br><span class="hljs-comment"> * @param subTitle - 分组标题</span><br><span class="hljs-comment"> * @param FormItemInfos - 二维数组 顺序和数量和分组标题对应 存放表单项信息</span><br><span class="hljs-comment"> * @param isLoading - `dva-loading` 执行effects过程中的loading</span><br><span class="hljs-comment"> * @param onSubmit - 传入的submit方法</span><br><span class="hljs-comment"> * @param buttonArea - 可选 不传默认数提交和取消 传入覆盖</span><br><span class="hljs-comment"> * @param children - 在表单下面 按钮区域上面的传入内容</span><br><span class="hljs-comment"> * @param formLayOutType - 布局方式 详情见`getLayOutByType`方法</span><br><span class="hljs-comment"> * @param model - 详情回显传入的值</span><br><span class="hljs-comment"> * @returns ReactNode</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> React, &#123; ReactNode &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;<br><span class="hljs-keyword">import</span> BaseForm <span class="hljs-keyword">from</span> <span class="hljs-string">'../BaseForm/BaseFormArea'</span>;<br><span class="hljs-keyword">import</span> &#123; Form, Row, Col, Button, message &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;<br><span class="hljs-keyword">import</span> SubmitLayOut <span class="hljs-keyword">from</span> <span class="hljs-string">'./SubmitLayOut'</span>;<br><span class="hljs-keyword">import</span> &#123; FormItemInfo &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../BaseForm/BaseFormArea'</span>;<br><span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">'./index.less'</span>;<br><br><span class="hljs-keyword">interface</span> IProps &#123;<br>  title?: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 新增页 主标题</span><br>  subTitle?: <span class="hljs-built_in">string</span>[]; <span class="hljs-comment">// 新增页 分组标题</span><br>  FormItemInfos: FormItemInfo[][]; <span class="hljs-comment">// 二维数组 应对项目里面表单内容分组</span><br>  buttonArea?: ReactNode; <span class="hljs-comment">// 重写按钮区域</span><br>  children?: ReactNode;<br>  formLayOutType?: FormLayOutType;<br>  model: &#123; [props: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">string</span> &#125;;<br>&#125;<br><br><span class="hljs-comment">// 水平和垂直布局</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> FormLayOutType &#123;<br>  normal = <span class="hljs-string">'normal'</span>,<br>  vertical = <span class="hljs-string">'vertical'</span>,<br>&#125;<br><br><span class="hljs-keyword">enum</span> CompType &#123;<br>  Select = <span class="hljs-string">'Select'</span>,<br>  PickerWrapper = <span class="hljs-string">'PickerWrapper'</span>,<br>&#125;<br><br><span class="hljs-keyword">const</span> detailStyle = &#123;<br>  width: <span class="hljs-string">'250px'</span>,<br>  overflow: <span class="hljs-string">'hidden'</span>,<br>  textOverflow: <span class="hljs-string">'ellipsis'</span>,<br>  display: <span class="hljs-string">'block'</span>,<br>  whiteSpace: <span class="hljs-string">'nowrap'</span>,<br>&#125;;<br><br><span class="hljs-keyword">const</span> FormDetail = <span class="hljs-function">(<span class="hljs-params">props: IProps</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> &#123; title, subTitle, FormItemInfos, buttonArea, children, formLayOutType, model &#125; = props;<br>  <span class="hljs-comment">// 根据分组的顺序 渲染表单区域</span><br>  <span class="hljs-keyword">const</span> renderFormArea = <span class="hljs-function">(<span class="hljs-params">idx: <span class="hljs-built_in">number</span></span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> FormItemInfo = FormItemInfos[idx];<br>    <span class="hljs-comment">// 在这边加上normal表单的layout</span><br>    <span class="hljs-keyword">const</span> _FormItemInfo = setFeatureToFormItemInfo(FormItemInfo);<br>    <span class="hljs-keyword">return</span> &lt;BaseForm isDetail formItems=&#123;_FormItemInfo&#125; /&gt;;<br>  &#125;;<br>  <span class="hljs-comment">// 鼠标移入 如果文本溢出 。。。 显示完整的</span><br>  <span class="hljs-keyword">const</span> onDetailMouseEnter = <span class="hljs-function">(<span class="hljs-params">e: <span class="hljs-built_in">any</span></span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> target = e.target;<br>    <span class="hljs-keyword">const</span> containerLength = target.offsetWidth;<br>    <span class="hljs-keyword">const</span> textLength = target.scrollWidth;<br>    <span class="hljs-keyword">const</span> text = target.innerHTML;<br>    <span class="hljs-keyword">if</span> (textLength &gt; containerLength) &#123;<br>      target.setAttribute(<span class="hljs-string">'title'</span>, text);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      target.removeAttribute(<span class="hljs-string">'title'</span>);<br>    &#125;<br>  &#125;;<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 根据传入参数 返回布局类型</span><br><span class="hljs-comment">   * @param type - 表单布局类型 可能为从左到右 也可能为自上而下 默认前者</span><br><span class="hljs-comment">   * @param FormItemInfo - 表单项信息</span><br><span class="hljs-comment">   * @returns FormItemInfo</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">const</span> getLayOutByType = (<span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span>, FormItemInfo: FormItemInfo[]): FormItemInfo[] =&gt; &#123;<br>    <span class="hljs-keyword">const</span> map: &#123; [props: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">Function</span> &#125; = &#123;<br>      <span class="hljs-comment">// 从左至右的布局</span><br>      [FormLayOutType.normal]: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">return</span> FormItemInfo.filter(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> [<span class="hljs-literal">undefined</span>, <span class="hljs-literal">true</span>].includes(item.visible)).map(<br>          (item, idx: <span class="hljs-built_in">number</span>) =&gt; &#123;<br>            <span class="hljs-keyword">if</span> (idx % <span class="hljs-number">3</span> === <span class="hljs-number">0</span>) &#123;<br>              <span class="hljs-keyword">return</span> &#123;<br>                colLayOut: &#123; span: <span class="hljs-number">6</span> &#125;,<br>                formItemLayout: &#123; labelCol: &#123; span: <span class="hljs-number">5</span> &#125;, wrapperCol: &#123; span: <span class="hljs-number">5</span> &#125; &#125;,<br>                ...item,<br>              &#125;;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>              <span class="hljs-keyword">return</span> &#123;<br>                colLayOut: &#123; span: <span class="hljs-number">6</span>, offset: <span class="hljs-number">2</span> &#125;,<br>                formItemLayout: &#123; labelCol: &#123; span: <span class="hljs-number">5</span> &#125;, wrapperCol: &#123; span: <span class="hljs-number">5</span> &#125; &#125;,<br>                ...item,<br>              &#125;;<br>            &#125;<br>          &#125;,<br>        );<br>      &#125;,<br>      <span class="hljs-comment">// 自上而下的布局</span><br>      [FormLayOutType.vertical]: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">return</span> FormItemInfo.map(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> (&#123;<br>          colLayOut: &#123; span: <span class="hljs-number">16</span>, offset: <span class="hljs-number">6</span> &#125;,<br>          formItemLayout: &#123;<br>            labelCol: &#123; span: <span class="hljs-number">5</span> &#125;,<br>            wrapperCol: &#123; span: <span class="hljs-number">8</span> &#125;,<br>            ...item.formItemLayout,<br>          &#125;,<br>          ...item,<br>        &#125;));<br>      &#125;,<br>    &#125;;<br>    <span class="hljs-keyword">return</span> map[<span class="hljs-keyword">type</span>]();<br>  &#125;;<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 给表单加上详情属性</span><br><span class="hljs-comment">   *    *</span><br><span class="hljs-comment">   * @param FormItemInfo - 表单项信息</span><br><span class="hljs-comment">   * @returns FormItemInfo</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">const</span> setDetailStyle = (FormItemInfos: FormItemInfo[]): FormItemInfo[] =&gt; &#123;<br>    <span class="hljs-keyword">return</span> FormItemInfos.map(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>      <span class="hljs-keyword">let</span> detailValue;<br>      <span class="hljs-keyword">if</span> (item.id.includes(<span class="hljs-string">'.'</span>)) &#123;<br>        <span class="hljs-keyword">const</span> wrapperArr = item.id.split(<span class="hljs-string">'.'</span>);<br>        <span class="hljs-comment">// @ts-ignore</span><br>        detailValue = wrapperArr.reduce(<br>          (previous, current) =&gt; previous &amp;&amp; previous[current],<br>          model,<br>        );<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        detailValue = model[item.id];<br>      &#125;<br>      <span class="hljs-keyword">if</span> (item.render) &#123;<br>        <span class="hljs-keyword">const</span> renderValueArr =<br>          item.renderParams &amp;&amp;<br>          item.renderParams.map(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>            <span class="hljs-keyword">const</span> _wrapperArr = item.split(<span class="hljs-string">'.'</span>);<br>            <span class="hljs-comment">// @ts-ignore</span><br>           <span class="hljs-keyword">const</span> _detailValue = _wrapperArr.reduce(<br>              (previous, current) =&gt; previous &amp;&amp; previous[current],<br>              model,<br>            );<br>            <span class="hljs-keyword">return</span> _detailValue;<br>          &#125;);<br>        <span class="hljs-keyword">return</span> &#123;<br>          Comp: item.render(detailValue, renderValueArr),<br>          isDetail: <span class="hljs-literal">true</span>,<br>          ...item,<br>          CompExtraProps: &#123; style: &#123; whiteSpace: <span class="hljs-string">'nowrap'</span> &#125; &#125;,<br>        &#125;;<br>      &#125;<br>      <span class="hljs-keyword">if</span> (item.Comp) &#123;<br>        <span class="hljs-keyword">return</span> &#123; isDetail: <span class="hljs-literal">true</span>, ...item, CompExtraProps: &#123; style: &#123; whiteSpace: <span class="hljs-string">'nowrap'</span> &#125; &#125; &#125;;<br>      &#125;<br>      <span class="hljs-keyword">if</span> (!detailValue &amp;&amp; detailValue !== <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">return</span> &#123;<br>          Comp: (<br>            &lt;span<br>              dangerouslySetInnerHTML=&#123;&#123; __html: <span class="hljs-string">'&amp;nbsp;'</span> &#125;&#125;<br>              style=&#123;&#123; whiteSpace: <span class="hljs-string">'nowrap'</span> &#125;&#125;<br>            &gt;&lt;<span class="hljs-regexp">/span&gt;</span><br><span class="hljs-regexp">          ),</span><br><span class="hljs-regexp">          isDetail: true,</span><br><span class="hljs-regexp">          ...item,</span><br><span class="hljs-regexp">        &#125;;</span><br><span class="hljs-regexp">      &#125;</span><br><span class="hljs-regexp">      /</span><span class="hljs-regexp">/ 对 fileIdEn特殊处理</span><br><span class="hljs-regexp">      if (item.id.includes('fileIdEn')) &#123;</span><br><span class="hljs-regexp">        /</span><span class="hljs-regexp">/ 如果是数组里的</span><br><span class="hljs-regexp">        const fileIdEnIdArr = item.id.split('.');</span><br><span class="hljs-regexp">        if (fileIdEnIdArr.length &gt; 1) &#123;</span><br><span class="hljs-regexp">          fileIdEnIdArr.splice(fileIdEnIdArr.length - 1, 1, 'fileName');</span><br><span class="hljs-regexp">          const fileNameValue = fileIdEnIdArr.reduce(</span><br><span class="hljs-regexp">            (previous, current) =&gt; previous &amp;&amp; previous[current],</span><br><span class="hljs-regexp">            model,</span><br><span class="hljs-regexp">          );</span><br><span class="hljs-regexp">          return &#123;</span><br><span class="hljs-regexp">            Comp: (</span><br><span class="hljs-regexp">              &lt;a</span><br><span class="hljs-regexp">                onMouseEnter=&#123;onDetailMouseEnter&#125;</span><br><span class="hljs-regexp">                style=&#123;detailStyle&#125;</span><br><span class="hljs-regexp">                target="_blank"</span><br><span class="hljs-regexp">                href=&#123;`/</span>api/file/downloadFile?fileIdEn=$&#123;detailValue&#125;<span class="hljs-string">`&#125;</span><br><span class="hljs-string">              &gt;</span><br><span class="hljs-string">                &#123;fileNameValue&#125;</span><br><span class="hljs-string">              &lt;/a&gt;</span><br><span class="hljs-string">            ),</span><br><span class="hljs-string">            isDetail: true,</span><br><span class="hljs-string">            ...item,</span><br><span class="hljs-string">          &#125;;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">        return &#123;</span><br><span class="hljs-string">          Comp: (</span><br><span class="hljs-string">            &lt;a</span><br><span class="hljs-string">              onMouseEnter=&#123;onDetailMouseEnter&#125;</span><br><span class="hljs-string">              style=&#123;detailStyle&#125;</span><br><span class="hljs-string">              target="_blank"</span><br><span class="hljs-string">              href=&#123;`</span>/api/file/downloadFile?fileIdEn=$&#123;model[<span class="hljs-string">'fileIdEn'</span>]&#125;<span class="hljs-string">`&#125;</span><br><span class="hljs-string">            &gt;</span><br><span class="hljs-string">              &#123;model['fileName']&#125;</span><br><span class="hljs-string">            &lt;/a&gt;</span><br><span class="hljs-string">          ),</span><br><span class="hljs-string">          isDetail: true,</span><br><span class="hljs-string">          ...item,</span><br><span class="hljs-string">        &#125;;</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">      return &#123;</span><br><span class="hljs-string">        Comp: item.id.includes('fileIdEn') ? (</span><br><span class="hljs-string">          &lt;a</span><br><span class="hljs-string">            onMouseEnter=&#123;onDetailMouseEnter&#125;</span><br><span class="hljs-string">            style=&#123;detailStyle&#125;</span><br><span class="hljs-string">            target="_blank"</span><br><span class="hljs-string">            href=&#123;`</span>/api/file/downloadFile?fileIdEn=$&#123;model[<span class="hljs-string">'fileIdEn'</span>]&#125;<span class="hljs-string">`&#125;</span><br><span class="hljs-string">          &gt;</span><br><span class="hljs-string">            &#123;model['fileName']&#125;</span><br><span class="hljs-string">          &lt;/a&gt;</span><br><span class="hljs-string">        ) : (</span><br><span class="hljs-string">          &lt;span onMouseEnter=&#123;onDetailMouseEnter&#125; style=&#123;detailStyle&#125;&gt;</span><br><span class="hljs-string">            &#123;detailValue&#125;</span><br><span class="hljs-string">          &lt;/span&gt;</span><br><span class="hljs-string">        ),</span><br><span class="hljs-string">        isDetail: true,</span><br><span class="hljs-string">        ...item,</span><br><span class="hljs-string">      &#125;;</span><br><span class="hljs-string">    &#125;);</span><br><span class="hljs-string">  &#125;;</span><br><span class="hljs-string"></span><br><span class="hljs-string">  const setFeatureToFormItemInfo = (FormItemInfos: FormItemInfo[]): FormItemInfo[] =&gt; &#123;</span><br><span class="hljs-string">    let result: FormItemInfo[];</span><br><span class="hljs-string">    result = getLayOutByType(formLayOutType || FormLayOutType.normal, FormItemInfos);</span><br><span class="hljs-string">    // result = setShowSearch(result)</span><br><span class="hljs-string">    result = setDetailStyle(result);</span><br><span class="hljs-string">    return result;</span><br><span class="hljs-string">  &#125;;</span><br><span class="hljs-string"></span><br><span class="hljs-string">  return (</span><br><span class="hljs-string">    &lt;Form labelAlign="left" className=&#123;styles.detailForm&#125;&gt;</span><br><span class="hljs-string">      &lt;SubmitLayOut subTitle=&#123;subTitle&#125; title=&#123;title&#125; renderFormArea=&#123;renderFormArea&#125;&gt;</span><br><span class="hljs-string">        &#123;children&#125;</span><br><span class="hljs-string">        &#123;buttonArea&#125;</span><br><span class="hljs-string">      &lt;/SubmitLayOut&gt;</span><br><span class="hljs-string">    &lt;/Form&gt;</span><br><span class="hljs-string">  );</span><br><span class="hljs-string">&#125;;</span><br><span class="hljs-string"></span><br><span class="hljs-string">export default FormDetail;</span><br></code></pre></td></tr></table></figure>
<h2 id="searchForm-搜索列表"><a href="#searchForm-搜索列表" class="headerlink" title="searchForm 搜索列表"></a>searchForm 搜索列表</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * @Author ZhangYunpeng0126</span><br><span class="hljs-comment"> * @Description 搜索表单</span><br><span class="hljs-comment"> * @param FormItemInfos - 一维数组 存放表单项内容对象</span><br><span class="hljs-comment"> * @param loading  - `dva-loading` 执行effects过程中的loading</span><br><span class="hljs-comment"> * @param history 路由信息</span><br><span class="hljs-comment"> * @param title - 主标题</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> React, &#123; ReactNode, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;<br><span class="hljs-keyword">import</span> SearchLayOut <span class="hljs-keyword">from</span> <span class="hljs-string">'./SearchLayOut'</span>;<br><span class="hljs-keyword">import</span> BaseForm, &#123; FormItemInfo &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../BaseForm/BaseFormArea'</span>;<br><span class="hljs-keyword">import</span> &#123; Row, Col, Button, Icon &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;<br><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'umi/router'</span>;<br><span class="hljs-keyword">import</span> moment <span class="hljs-keyword">from</span> <span class="hljs-string">'moment'</span>;<br><span class="hljs-comment">// @ts-ignore</span><br><span class="hljs-keyword">import</span> queryString <span class="hljs-keyword">from</span> <span class="hljs-string">'query-string'</span>;<br><span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/XyzForm/SearchForm/index.less'</span>;<br><span class="hljs-keyword">import</span> &#123; unShowSearchToken &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../../../constants/index'</span>;<br><span class="hljs-keyword">import</span> &#123; PaginationConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'antd/lib/pagination'</span>;<br><span class="hljs-keyword">import</span> Item <span class="hljs-keyword">from</span> <span class="hljs-string">'antd/lib/list/Item'</span>;<br><br><span class="hljs-comment">// 搜索表单 默认的formItemLayout</span><br><span class="hljs-keyword">const</span> formItemLayout = &#123;<br>  labelCol: &#123; span: <span class="hljs-number">8</span> &#125;,<br>  wrapperCol: &#123; span: <span class="hljs-number">16</span> &#125;,<br>&#125;;<br><br><span class="hljs-keyword">enum</span> initValue &#123;<br>  Empty = <span class="hljs-string">''</span>,<br>  All = <span class="hljs-string">'-1'</span>,<br>&#125;<br><br><span class="hljs-keyword">enum</span> matchKeyName &#123;<br>  Time = <span class="hljs-string">'Time'</span>,<br>  <span class="hljs-built_in">Date</span> = <span class="hljs-string">'Date'</span>,<br>&#125;<br><br><span class="hljs-keyword">const</span> dateFormatSt = <span class="hljs-string">'YYYY-MM-DD 00:00:00'</span>;<br><span class="hljs-keyword">const</span> dateFormatEd = <span class="hljs-string">'YYYY-MM-DD 23:59:59'</span>;<br><span class="hljs-keyword">const</span> dateFormat = <span class="hljs-string">'YYYY-MM-DD'</span>;<br><span class="hljs-keyword">interface</span> TableProps &#123;<br>  loading: <span class="hljs-built_in">boolean</span>;<br>  columns: [];<br>  dataSource: [];<br>&#125;<br><br><span class="hljs-keyword">interface</span> IProps &#123;<br>  FormItemInfos: FormItemInfo[];<br>  form: &#123; getFieldsValue: <span class="hljs-built_in">Function</span>; resetFields: <span class="hljs-built_in">Function</span> &#125;;<br>  loading?: <span class="hljs-built_in">boolean</span>;<br>  history: &#123; location: &#123; pathname: <span class="hljs-built_in">string</span>; query: &#123; [props: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">string</span> &#125; &#125; &#125;;<br>  title?: <span class="hljs-built_in">string</span> | ReactNode;<br>  children: <span class="hljs-built_in">any</span>;<br>  tableProps?: TableProps;<br>  extraButtonArea?: ReactNode;<br>  handleSearch?: <span class="hljs-built_in">Function</span>;<br>&#125;<br><span class="hljs-keyword">enum</span> CompType &#123;<br>  Select = <span class="hljs-string">'Select'</span>,<br>  PickerWrapper = <span class="hljs-string">'PickerWrapper'</span>,<br>  Cascader = <span class="hljs-string">'Cascader'</span>,<br>  RangePicker = <span class="hljs-string">'RangePicker'</span>,<br>  MonthPicker = <span class="hljs-string">'MonthPicker'</span>,<br>  RangeInputNumber = <span class="hljs-string">'RangeInputNumber'</span>,<br>&#125;<br><br><span class="hljs-keyword">enum</span> initVal &#123;<br>  Zero = <span class="hljs-string">'0'</span>,<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SearchForm</span>(<span class="hljs-params">props: IProps</span>) </span>&#123;<br>  <span class="hljs-keyword">const</span> &#123; FormItemInfos, form, loading, history, title, children, extraButtonArea, handleSearch &#125; = props;<br>  <span class="hljs-keyword">const</span> [expand, setExpand] = useState(<span class="hljs-literal">true</span>);<br><br>  <span class="hljs-keyword">const</span> OnpaginationChange = (<br>    pagination: PaginationConfig,<br>    filtersArg: object,<br>    sorter: &#123; order: <span class="hljs-built_in">string</span>; field: <span class="hljs-built_in">string</span> &#125;,<br>  ) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> &#123; pathname, query &#125; = history.location;<br>    <span class="hljs-keyword">const</span> params: &#123; [propName: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span> &#125; = &#123;<br>      page: pagination.current === <span class="hljs-number">1</span> ? <span class="hljs-literal">undefined</span> : pagination.current,<br>      limit: pagination.pageSize === <span class="hljs-number">10</span> ? <span class="hljs-literal">undefined</span> : pagination.pageSize,<br>    &#125;;<br>    <span class="hljs-keyword">if</span> (sorter &amp;&amp; sorter.field) &#123;<br>      <span class="hljs-keyword">const</span> &#123; field, order &#125; = sorter;<br>      params.orderType = order === <span class="hljs-string">'ascend'</span> ? <span class="hljs-string">'ASC'</span> : <span class="hljs-string">'DESC'</span>;<br>      params.orderBy = field;<br>    &#125;<br>    router.push(&#123;<br>      pathname,<br>      search: queryString.stringify(&#123;<br>        ...query,<br>        ...params,<br>      &#125;),<br>    &#125;);<br>  &#125;;<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * @Author ZhangYunpeng0126</span><br><span class="hljs-comment">   * @Description 搜索方法 拼上路由方法 dva监听到去请求</span><br><span class="hljs-comment">   * @Date 11:53 2019/12/5</span><br><span class="hljs-comment">   */</span><br><br>  <span class="hljs-keyword">const</span> onSearch = (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; pathname &#125; = history.location;<br>    <span class="hljs-keyword">const</span> params = getParams();<br>    <span class="hljs-comment">// debugger</span><br>    router.push(&#123;<br>      pathname,<br>      search: queryString.stringify(&#123;<br>        ...params,<br>      &#125;),<br>    &#125;);<br>  &#125;;<br><br>  <span class="hljs-keyword">const</span> toggle = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>    setExpand(<span class="hljs-function">(<span class="hljs-params">prev: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> !prev);<br>  &#125;;<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * @Author ZhangYunpeng0126</span><br><span class="hljs-comment">   * @Description 清除搜索内容 并清除url上拼的参数</span><br><span class="hljs-comment">   * @Date 11:37 2019/12/5</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">const</span> onClearSearch = (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; pathname &#125; = history.location;<br>    form.resetFields();<br>    router.push(&#123;<br>      pathname,<br>    &#125;);<br>  &#125;;<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * @Author ZhangYunpeng0126</span><br><span class="hljs-comment">   * @Description 获取搜索键值对象</span><br><span class="hljs-comment">   * @Date 15:00 2019/12/9</span><br><span class="hljs-comment">   * @return object 搜索键值对象</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">const</span> getParams = (): &#123; [propName: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">string</span> &#125; =&gt; &#123;<br>    <span class="hljs-keyword">const</span> &#123; getFieldsValue &#125; = form;<br>    <span class="hljs-keyword">const</span> fields = getFieldsValue();<br>    <span class="hljs-built_in">console</span>.log(fields);<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> fields) &#123;<br>      <span class="hljs-keyword">const</span> formItemInfo = FormItemInfos.find(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.id === key);<br>      <span class="hljs-keyword">let</span> <span class="hljs-keyword">type</span>;<br>      <span class="hljs-keyword">if</span> (formItemInfo) &#123;<br>        <span class="hljs-keyword">type</span> = formItemInfo.type;<br>      &#125;<br>      <span class="hljs-keyword">if</span> ([initValue.All, initValue.Empty].includes(fields[key])) &#123;<br>        <span class="hljs-keyword">delete</span> fields[key];<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === CompType.RangePicker) &#123;<br>        fields[key + <span class="hljs-string">'Start'</span>] = fields[key][<span class="hljs-number">0</span>]?.format(dateFormatSt);<br>        fields[key + <span class="hljs-string">'End'</span>] = fields[key][<span class="hljs-number">1</span>]?.format(dateFormatEd);<br>        <span class="hljs-keyword">delete</span> fields[key];<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === CompType.PickerWrapper) &#123;<br>        fields[key] = fields[key].format(dateFormat);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === CompType.MonthPicker) &#123;<br>        fields[key] = fields[key].format(<span class="hljs-string">'YYYY-MM'</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === CompType.RangeInputNumber) &#123;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'RangeInputNumber'</span>, fields[key].start);<br>        <span class="hljs-comment">// debugger</span><br>        fields[key + <span class="hljs-string">'Start'</span>] = fields[key]?.start;<br>        fields[key + <span class="hljs-string">'End'</span>] = fields[key]?.end;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'RangeInputNumber'</span>, fields[key + <span class="hljs-string">'Start'</span>]);<br>        <span class="hljs-keyword">delete</span> fields[key];<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fields[key] === <span class="hljs-string">'string'</span>) &#123;<br>        fields[key] = fields[key].trim();<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> fields;<br>  &#125;;<br>  <span class="hljs-keyword">const</span> getLayOut = (FormItemInfos: FormItemInfo[]): FormItemInfo[] =&gt; &#123;<br>    <span class="hljs-keyword">return</span> FormItemInfos.map(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> (&#123;<br>      colLayOut: &#123; span: <span class="hljs-number">8</span> &#125;,<br>      formItemLayout: formItemLayout,<br>      ...item,<br>    &#125;));<br>  &#125;;<br><br>  <span class="hljs-keyword">const</span> setInitValue = (FormItemInfos: FormItemInfo[]): FormItemInfo[] =&gt; &#123;<br>    <span class="hljs-comment">// initialValue</span><br>    <span class="hljs-keyword">const</span> &#123; query &#125; = history.location;<br><br>    <span class="hljs-keyword">return</span> FormItemInfos.map(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (item.type === CompType.RangePicker) &#123;<br>        <span class="hljs-keyword">return</span> &#123;<br>          initialValue: query[<span class="hljs-string">`<span class="hljs-subst">$&#123;item.id&#125;</span>Start`</span>] &amp;&amp;<br>            query[<span class="hljs-string">`<span class="hljs-subst">$&#123;item.id&#125;</span>End`</span>] &amp;&amp; [<br>              moment(query[<span class="hljs-string">`<span class="hljs-subst">$&#123;item.id&#125;</span>Start`</span>]),<br>              moment(query[<span class="hljs-string">`<span class="hljs-subst">$&#123;item.id&#125;</span>End`</span>]),<br>            ],<br>          ...item,<br>        &#125;;<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.type === CompType.PickerWrapper) &#123;<br>        <span class="hljs-keyword">return</span> &#123; initialValue: query[item.id] &amp;&amp; moment(query[item.id]), ...item &#125;;<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.type === CompType.Select) &#123;<br>        <span class="hljs-built_in">console</span>.log(&#123;<br>          initialValue: <span class="hljs-string">`<span class="hljs-subst">$&#123;query[item.id]&#125;</span>`</span> === initVal.Zero ? <span class="hljs-string">`<span class="hljs-subst">$&#123;query[item.id]&#125;</span>`</span> : <span class="hljs-string">''</span>,<br>          ...item,<br>        &#125;);<br>        <span class="hljs-keyword">return</span> &#123;<br>          initialValue: <span class="hljs-string">`<span class="hljs-subst">$&#123;query[item.id]&#125;</span>`</span> === initVal.Zero ? <span class="hljs-string">`<span class="hljs-subst">$&#123;query[item.id]&#125;</span>`</span> : <span class="hljs-string">''</span>,<br>          ...item,<br>        &#125;;<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.type === CompType.RangeInputNumber) &#123;<br>        <span class="hljs-keyword">return</span> &#123;<br>          initialValue: &#123; start: query[<span class="hljs-string">`<span class="hljs-subst">$&#123;item.id&#125;</span>Start`</span>], end: query[<span class="hljs-string">`<span class="hljs-subst">$&#123;item.id&#125;</span>End`</span>] &#125;,<br>          ...item,<br>        &#125;;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> &#123; initialValue: query[item.id], ...item &#125;;<br>      &#125;<br>    &#125;);<br>  &#125;;<br><br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">   * @Author: zhangyunpeng</span><br><span class="hljs-comment">   * @Date: 2020-01-13 09:11:01</span><br><span class="hljs-comment">   * @Last Modified by:   zhangyunpeng</span><br><span class="hljs-comment">   * @Last Modified time: 2020-01-13 09:11:01</span><br><span class="hljs-comment">   * @Summary: 根据Select类型塞入是否可搜索、可清空feture</span><br><span class="hljs-comment">   * @param: FormItemInfo[]</span><br><span class="hljs-comment">   * @returns: FormItemInfo[] */</span><br>  <span class="hljs-keyword">const</span> setShowSearch = (FormItemInfos: FormItemInfo[]): FormItemInfo[] =&gt; &#123;<br>    <span class="hljs-keyword">return</span> FormItemInfos.map(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>      <span class="hljs-comment">// 是否传入组件</span><br>      <span class="hljs-keyword">const</span> <span class="hljs-keyword">type</span> = item.type;<br>      <span class="hljs-comment">// 加入可清空属性</span><br>      <span class="hljs-keyword">const</span> commonFeature = &#123; allowClear: <span class="hljs-literal">true</span> &#125;;<br>      <span class="hljs-comment">// 如果是‘Select’组件且name不在配置之中</span><br>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> &amp;&amp; <span class="hljs-keyword">type</span> === CompType.Select) &#123;<br>        <span class="hljs-keyword">if</span> (!unShowSearchToken.includes(item.id)) &#123;<br>          <span class="hljs-keyword">return</span> &#123;<br>            CompExtraProps: &#123; ...commonFeature, showSearch: <span class="hljs-literal">true</span>, optionFilterProp: <span class="hljs-string">'children'</span> &#125;,<br>            ...item,<br>          &#125;;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-keyword">return</span> &#123; CompExtraProps: &#123; ...commonFeature &#125;, ...item &#125;;<br>        &#125;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> item;<br>      &#125;<br>    &#125;);<br>  &#125;;<br>  <span class="hljs-keyword">const</span> setExpandFormItems = (FormItemInfos: FormItemInfo[]): FormItemInfo[] =&gt; &#123;<br>    <span class="hljs-keyword">return</span> expand ? FormItemInfos.slice(<span class="hljs-number">0</span>, <span class="hljs-number">6</span>) : FormItemInfos;<br>  &#125;;<br><br>  <span class="hljs-keyword">const</span> setFeatureToFormItems = (FormItemInfos: FormItemInfo[]): FormItemInfo[] =&gt; &#123;<br>    <span class="hljs-keyword">return</span> setInitValue(setShowSearch(getLayOut(setExpandFormItems(FormItemInfos))));<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> (<br>    &lt;SearchLayOut title=&#123;title&#125;&gt;<br>      &lt;div className=&#123;styles.searchAreaContent&#125;&gt;<br>        &lt;BaseForm form=&#123;form&#125; formItems=&#123;setFeatureToFormItems(FormItemInfos)&#125; /&gt;<br>        &lt;Row <span class="hljs-keyword">type</span>=<span class="hljs-string">"flex"</span> gutter=&#123;<span class="hljs-number">24</span>&#125; justify=<span class="hljs-string">"end"</span>&gt;<br>          &lt;Col&gt;<br>            &lt;Button <span class="hljs-keyword">type</span>=<span class="hljs-string">"primary"</span> onClick=&#123; handleSearch ? handleSearch : onSearch &#125; loading=&#123;loading&#125;&gt;<br>              查询<br>            &lt;<span class="hljs-regexp">/Button&gt;</span><br><span class="hljs-regexp">          &lt;/</span>Col&gt;<br>          &lt;Col&gt;<br>            &lt;Button <span class="hljs-keyword">type</span>=<span class="hljs-string">"default"</span> onClick=&#123;onClearSearch&#125; loading=&#123;loading&#125;&gt;<br>              重置<br>            &lt;<span class="hljs-regexp">/Button&gt;</span><br><span class="hljs-regexp">          &lt;/</span>Col&gt;<br>          &lt;If condition=&#123;FormItemInfos.length &gt; <span class="hljs-number">6</span>&#125;&gt;<br>            &lt;Col style=&#123;&#123; display: <span class="hljs-string">'flex'</span>, alignItems: <span class="hljs-string">'center'</span> &#125;&#125;&gt;<br>              &lt;a style=&#123;&#123; marginLeft: <span class="hljs-number">8</span>, fontSize: <span class="hljs-number">12</span> &#125;&#125; onClick=&#123;toggle&#125;&gt;<br>                &#123;expand ? <span class="hljs-string">'展开'</span> : <span class="hljs-string">'收起'</span>&#125; &lt;Icon <span class="hljs-keyword">type</span>=&#123;expand ? <span class="hljs-string">'down'</span> : <span class="hljs-string">'up'</span>&#125; /&gt;<br>              &lt;<span class="hljs-regexp">/a&gt;</span><br><span class="hljs-regexp">            &lt;/</span>Col&gt;<br>          &lt;<span class="hljs-regexp">/If&gt;</span><br><span class="hljs-regexp">        &lt;/</span>Row&gt;<br>        &lt;Row&gt;&#123;extraButtonArea&#125;&lt;<span class="hljs-regexp">/Row&gt;</span><br><span class="hljs-regexp">      &lt;/</span>div&gt;<br>      &#123;React.cloneElement(children, &#123; onChange: OnpaginationChange &#125;)&#125;<br>    &lt;<span class="hljs-regexp">/SearchLayOut&gt;</span><br><span class="hljs-regexp">  );</span><br><span class="hljs-regexp">&#125;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">export default SearchForm;</span><br></code></pre></td></tr></table></figure>

<h2 id="ModalForm-弹窗表单"><a href="#ModalForm-弹窗表单" class="headerlink" title="ModalForm 弹窗表单"></a>ModalForm 弹窗表单</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; Modal, Form &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;<br><span class="hljs-keyword">import</span> SubmitForm <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/XyzForm/SubmitForm'</span>;<br><span class="hljs-keyword">import</span> React, &#123; ReactNode, ReactElement, useState,useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;<br><span class="hljs-keyword">import</span> &#123; FormItemInfo &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/XyzForm/BaseForm/BaseFormArea'</span>;<br><span class="hljs-keyword">import</span> BaseResponse <span class="hljs-keyword">from</span> <span class="hljs-string">'@/requests/common/BaseResponse'</span>;<br><span class="hljs-keyword">import</span> &#123; ModalProps &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'antd/lib/modal'</span>;<br><span class="hljs-keyword">import</span> &#123; useDispatch &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react-redux'</span>;<br><br><span class="hljs-keyword">interface</span> Iprops &#123;<br>  modalProps?: ModalProps; <span class="hljs-comment">// 弹框属性</span><br>  children: ReactElement; <span class="hljs-comment">// 按钮</span><br>  extraFormProps: IFormProps; <span class="hljs-comment">//表单属性</span><br>  request: <span class="hljs-function">(<span class="hljs-params">params: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">Promise</span>&lt;BaseResponse&gt;; <span class="hljs-comment">// 请求</span><br>  extraParams?: &#123;&#125;; <span class="hljs-comment">// 表单以外额外参数</span><br>  callBack?: <span class="hljs-built_in">Function</span>; <span class="hljs-comment">// 保存完回调,</span><br>  onParamsPreHandle?: <span class="hljs-built_in">Function</span>; <span class="hljs-comment">// 前置处理参数</span><br>  formRef?:<span class="hljs-keyword">typeof</span> useRef; <span class="hljs-comment">// 拿表单form</span><br>&#125;<br><span class="hljs-keyword">interface</span> IFormProps &#123;<br>  title?: <span class="hljs-built_in">string</span> | ReactNode; <span class="hljs-comment">// 新增页 主标题</span><br>  subTitle?: <span class="hljs-built_in">string</span>[]; <span class="hljs-comment">// 新增页 分组标题</span><br>  FormItemInfos: FormItemInfo[][]; <span class="hljs-comment">// 二维数组 应对项目里面表单内容分组</span><br>  isLoading?: <span class="hljs-built_in">boolean</span>; <span class="hljs-comment">// dva的loading</span><br>  buttonArea?: ReactNode; <span class="hljs-comment">// 重写按钮区域</span><br>  children?: ReactNode;<br>  formLayOutType?: <span class="hljs-built_in">string</span>;<br>  model?: &#123; [props: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">string</span> &#125;;<br>&#125;<br><span class="hljs-keyword">const</span> FormModal = <span class="hljs-function">(<span class="hljs-params">props: Iprops</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> dispatch = useDispatch();<br>  <span class="hljs-keyword">const</span> &#123;<br>    formRef,<br>    onParamsPreHandle,<br>    children,<br>    extraFormProps,<br>    request,<br>    modalProps,<br>    extraParams,<br>    callBack,<br>  &#125; = props;<br>  <span class="hljs-keyword">const</span> [visible, setVisible] = useState(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">const</span> [loading, setLoading] = useState(<span class="hljs-literal">false</span>);<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'children'</span>, children);<br>  <span class="hljs-keyword">const</span> onButtonClick = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (children.props.onClick &amp;&amp; children.props.onClick()) &#123;<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    setVisible(<span class="hljs-literal">true</span>);<br>  &#125;;<br>  <span class="hljs-keyword">const</span> onSubmit = <span class="hljs-function">(<span class="hljs-params">values: &#123; fileIdEn: <span class="hljs-built_in">string</span> &#125;</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">//  debugger</span><br>    onParamsPreHandle ? (values = onParamsPreHandle(values)) : <span class="hljs-literal">null</span>;<br>    <span class="hljs-comment">//   debugger</span><br>    setLoading(<span class="hljs-literal">true</span>);<br>    request(&#123; ...values, ...(extraParams || &#123;&#125;) &#125;)<br>      .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (res.isSuccess()) &#123;<br>          setVisible(<span class="hljs-literal">false</span>);<br>          setLoading(<span class="hljs-literal">false</span>);<br>          callBack &amp;&amp; callBack();<br>          dispatch(&#123;<br>            <span class="hljs-keyword">type</span>: <span class="hljs-string">'app/updateState'</span>,<br>            payload: &#123; isAuthorized: <span class="hljs-literal">true</span> &#125;,<br>          &#125;);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          setLoading(<span class="hljs-literal">false</span>);<br>          dispatch(&#123;<br>            <span class="hljs-keyword">type</span>: <span class="hljs-string">'app/updateState'</span>,<br>            payload: &#123; isAuthorized: <span class="hljs-literal">true</span> &#125;,<br>          &#125;);<br>        &#125;<br>      &#125;)<br>      .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>        setLoading(<span class="hljs-literal">false</span>);<br>        <span class="hljs-built_in">console</span>.log(err);<br>      &#125;);<br>  &#125;;<br><br>  <span class="hljs-keyword">const</span> onModalCancel = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>    setVisible(<span class="hljs-literal">false</span>);<br>  &#125;;<br>  <span class="hljs-keyword">const</span> InnerForm =Form.create()(<span class="hljs-function">(<span class="hljs-params">&#123; form &#125;</span>) =&gt;</span>&#123; <br>    formRef? formRef.current=form:<span class="hljs-literal">null</span><br>  <span class="hljs-keyword">return</span> (&lt;SubmitForm<br>      form=&#123;form&#125;<br>      onSubmit=&#123;onSubmit&#125;<br>      onCancel=&#123;onModalCancel&#125;<br>      &#123;...extraFormProps&#125;<br>      isLoading=&#123;loading&#125;<br>    /&gt;<br>  )&#125;);<br>  <span class="hljs-comment">// tslint:disable-next-line:jsx-wrap-multiline</span><br>  <span class="hljs-keyword">return</span> (<br>    &lt;&gt;<br>      &#123;React.cloneElement(children, &#123; onClick: onButtonClick &#125;)&#125;<br>      &lt;Modal width=&#123;<span class="hljs-number">800</span>&#125; visible=&#123;visible&#125; footer=&#123;<span class="hljs-literal">null</span>&#125; onCancel=&#123;onModalCancel&#125; &#123;...modalProps&#125;&gt;<br>        &#123;InnerForm &amp;&amp; &lt;InnerForm /&gt;&#125;<br>      &lt;<span class="hljs-regexp">/Modal&gt;</span><br><span class="hljs-regexp">    &lt;/</span>&gt;<br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> FormModal;<br></code></pre></td></tr></table></figure>

<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>个人觉得封装的思路主要是</p>
<ul>
<li>底层组件越纯粹越好</li>
<li>中层可以实现一些适用性比较高的具体业务组件和通用方法</li>
<li>高层就具体要页面的细节的方方面面了</li>
</ul>

    </section>
    <section class="extra">
      
        <section class="donate">
  <div class="qrcode">
    <img   class="lazyload" data-original="https://pic.imgdb.cn/item/622edf135baa1a80abb1276b.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" >
  </div>
  <div class="icon">
    <a href="javascript:;" id="alipay"><i class="iconfont iconalipay"></i></a>
    <a href="javascript:;" id="wechat"><i class="iconfont iconwechat-fill"></i></a>
  </div>
</section>
      
      
      
<nav class="nav">
  
    <a href="/2023/10/27/%E5%9F%BA%E4%BA%8Eantd3.x%E7%9A%84%E5%8A%A8%E6%80%81%E8%A1%A8%E5%8D%95%E7%BB%84%E4%BB%B6%E8%AE%BE%E8%AE%A1/"><i class="iconfont iconleft"></i>基于antd3.x的动态表单组件设计</a>
  
  
    <a href="/2023/10/27/%E5%BE%AE%E5%89%8D%E7%AB%AF%E5%AE%9E%E6%88%98%E2%80%94%E2%80%94%E4%B8%8D%E5%90%8C%E5%9F%9F%E4%B9%8B%E9%97%B4%E7%9A%84iframe%E8%B0%83%E7%94%A8/">微前端实战——不同域之间的iframe调用<i class="iconfont iconright"></i></a>
  
</nav>

    </section>
    
      <section class="comments">
        
          <div class="btn" id="comments-btn">查看评论</div>
        
        
<div id="valine"></div>
<script defer src="//cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js"></script>
<script>
  window.onload = function () {
    var loadValine = function () {
      new Valine({
        el: '#valine',
        app_id: "XgHS51JuLkeipj92BK4KyIEI-gzGzoHsz",
        app_key: "LHxBDnRt6RQCuByhRfp1pkVN",
        placeholder: "ヾﾉ≧∀≦)o来啊，快活啊!",
        avatar: "mp",
        pageSize: "10",
        lang: "zh-CN",
      });
    }
    if ( true ) {
      $("#comments-btn").on("click", function () {
        $(this).hide();
        loadValine();
      });
    } else {
      loadValine();
    }
  };
</script>


      </section>
    
  </section>
</article>
  </div>
</main>
  <footer class="footer">
  <div class="footer-social">
    
    
    
    
    
    <a href="tencent://message/?Menu=yes&uin=694534942 " target="_blank" onMouseOver="this.style.color= '#12B7F5'"
      onMouseOut="this.style.color='#33333D'">
      <i class="iconfont footer-social-item  iconQQ "></i>
    </a>
    
    
    
    
    
    <a href="https://pic.imgdb.cn/item/6231b2785baa1a80abf9af9c.jpg " target="_blank" onMouseOver="this.style.color= '#09BB07'"
      onMouseOut="this.style.color='#33333D'">
      <i class="iconfont footer-social-item  iconwechat-fill "></i>
    </a>
    
    
    
    
    
    <a href="https://www.instagram.com/gaintpenggle/ " target="_blank" onMouseOver="this.style.color= '#DA2E76'"
      onMouseOut="this.style.color='#33333D'">
      <i class="iconfont footer-social-item  iconinstagram "></i>
    </a>
    
    
    
    
    
    <a href="https://github.com/zoyopo " target="_blank" onMouseOver="this.style.color= '#24292E'"
      onMouseOut="this.style.color='#33333D'">
      <i class="iconfont footer-social-item  icongithub-fill "></i>
    </a>
    
    
    
    
    
    <a href="mailto:694534942@qq.com " target="_blank" onMouseOver="this.style.color='#ff9800'"
      onMouseOut="this.style.color='#33333D'">
      <i class="iconfont footer-social-item  iconmail"></i>
    </a>
    
  </div>
  <div class="footer-copyright"><p>Copyright© 2021-2022 | <a target="_blank" href="https://github.com/zoyopo">小笼包</a> .AllRightsReserved</p></div>
</footer>
  
      <div class="fab fab-plus">
    <i class="iconfont iconplus"></i>
  </div>
  <div class="fab fab-up">
    <i class="iconfont iconcaret-up"></i>
  </div>
  <div class="fab fab-menu">
    <i class="iconfont iconmenu"></i>
  </div>
  
</body>


<script src="/lib/jquery/jquery.js"></script>






<script src="/lib/fancybox/fancybox.js"></script>








<script src="/lib/lazyload/lazyload.js"></script>






<script src="/lib/justifiedGallery/justifiedGallery.js"></script>






<script src="/js/script.js"></script>



<script>
  (function () {
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
      bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    } else {
      bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
  })();
</script>











</html>